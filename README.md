# NoviCode

**プログラミング学習に特化したコーディングツール**

NoviCode は、あなたのパソコンだけで動くプログラミング学習用の AI です。
インターネットに接続しなくても使えます。
[Ollama](https://ollama.ai) というソフトの上で動きます。

ふつうの AI チャットや AI コーディングツールとは違い、**段階的にステップバイステップで教える**のが特徴です。
「電卓を作って」と言われても完成品を一括で出すのではなく、設計 → 最小コード → 動作確認 → 機能追加、と一歩ずつ進みます。
使いながらプログラミングの基礎・セキュリティ・テスト・実運用の知識が自然に身につきます。

---

## NoviCode の特徴

- **段階的な教育** — 完成品を一括出力せず、ステップバイステップで理解させながら構築
- **レベルシステム** — 初級 → 中級 → 上級、学んだ概念を自動追跡してレベルアップ
- **練習問題** — 各モード・レベルに合わせたチャレンジ問題で実力を確認
- **セキュリティ教育** — 危険な操作がブロックされたとき「なぜ危険か」を解説
- **言語の分離** — Python モードで HTML が出てきたり、その逆が起きたりしない
- **ローカル動作** — すべてパソコンの中で完結。データが外部に送られない

---

## 6つの学習モード

使いたい分野を選んでからスタートします。モードごとに使える言語とライブラリが決まっています。

| モード | 何を学べる？ | 使う言語 | 使えるライブラリ |
|--------|-------------|---------|----------------|
| `python_basic` | Pythonの基礎 | Python | 標準ライブラリのみ |
| `py5` | お絵かき・アニメーション | Python | py5（Processing） |
| `sklearn` | AIと機械学習の入門 | Python | scikit-learn, numpy |
| `pandas` | データ分析とグラフ | Python | pandas, matplotlib, seaborn |
| `aframe` | ブラウザで3D・VR | HTML + JS | A-Frame |
| `threejs` | ブラウザで3Dグラフィックス | HTML + JS | Three.js |

この6つ以外のお願い（たとえば「Javaで書いて」「Dockerを使って」など）には、丁寧にお断りします。

---

## 使えるAIモデル

| モデル | 必要なメモリ | 特徴 |
|--------|------------|------|
| `qwen3:8b` | 8 GB 以上 | 軽量。メモリが少ないパソコンでもOK |
| `qwen3-coder:30b` | 32 GB 以上 | 高性能。より正確なコード生成 |

起動時にパソコンのメモリを調べて、自動的に最適なモデルを選んでくれます。

---

## はじめる前に必要なもの

NoviCode を動かすには、以下の3つが必要です。
はじめての方は、上から順番にセットアップしてください。

| 必要なもの | 何をするもの？ | 確認コマンド |
|-----------|--------------|-------------|
| uv | Python の環境をまとめて管理してくれるツール | `uv --version` |
| Git | ソースコードをダウンロードする | `git --version` |
| Ollama | AIモデルを動かすためのソフト | `ollama --version` |

> **uv って何？**
> uv は Python のインストール・パッケージ管理・仮想環境の作成をまとめてやってくれるツールです。
> Python がまだ入っていなくても、uv が自動的にダウンロードしてくれるので安心です。

---

## ステップ 1: uv のインストール

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

または Homebrew でもインストールできます。
```bash
brew install uv
```

インストールできたか確認しましょう。

```bash
uv --version
```

バージョンが表示されればOKです。

---

## ステップ 2: Git のインストール

```bash
git --version
```

表示されない場合：

```bash
# 初回実行時に自動でインストールされます
xcode-select --install
```

---

## ステップ 3: Ollama のインストール

Ollama は、AIモデルをパソコンの中で動かすためのソフトです。
これがないと NoviCode は動きません。

https://ollama.com/download/mac からダウンロードして、アプリケーションフォルダに入れてください。

または Homebrew でもインストールできます。
```bash
brew install ollama
```

### Ollama が動いているか確認する

インストール後、ターミナルで以下を入力してください。

```bash
ollama --version
```

バージョンが表示されればインストール成功です。

次に、Ollama を起動します。

```bash
ollama serve
```

`ollama serve` を実行すると、そのターミナルは Ollama のサーバーとして使われるため、他のコマンドを入力できなくなります。
**ターミナルをもう1つ開いて**、そちらで次のステップに進んでください。

> **アプリ版を使っている場合：** Ollama.app を起動すれば自動で `ollama serve` が動きます。メニューバーにラマのアイコンが出ていればOKです。この場合、ターミナルを別に開く必要はありません。

---

## ステップ 4: AIモデルのダウンロード

Ollama が起動している状態で、AIモデルをダウンロードします。
（初回は数GBのダウンロードがあるので、少し時間がかかります）

```bash
ollama pull qwen3:8b
```

ダウンロードが終わったら、正しく入ったか確認しましょう。

```bash
ollama list
```

`qwen3:8b` が一覧に表示されていればOKです。

### メモリに余裕がある場合（32GB 以上）

より高性能な `qwen3-coder:30b` も使えます。

```bash
ollama pull qwen3-coder:30b
```

> **「requires a newer version」というエラーが出たら？**
>
> `qwen3-coder:30b` は **Ollama 0.3.15 以降**が必要です。
> https://ollama.com/download からアプリを再ダウンロードして上書きインストールしてください。
> または Homebrew なら：
> ```bash
> brew upgrade ollama
> ```

---

## ステップ 5: NoviCode のインストール

```bash
git clone https://github.com/RNMUDS/NoviCode.git
cd NoviCode
uv sync
```

`uv sync` を実行すると、以下が自動的に行われます。

- 必要なバージョンの Python がなければ自動ダウンロード
- 仮想環境（`.venv`）の作成
- 必要なパッケージのインストール

これで準備完了です。

> **うまく動かない場合：**
> `.venv` を削除してからやり直してください。
> ```bash
> rm -rf .venv
> uv sync
> ```

### 起動するときは

`uv run` をつけてコマンドを実行します。

```bash
uv run novicode --mode python_basic
```

> **`uv run` って何？**
> `uv sync` で作った仮想環境の中でコマンドを実行する、という意味です。
> 毎回つけるのが面倒なら、以下で仮想環境に入ってから使うこともできます。
> ```bash
> source .venv/bin/activate
> novicode --mode python_basic
> ```

---

## うまくいかないときは

| 症状 | 原因と対処 |
|------|-----------|
| `ollama: command not found` | Ollama がインストールされていません。ステップ3を確認してください |
| `Error: ollama server not responding` | Ollama が起動していません。`ollama serve` を実行するか、Ollama.app を起動してください |
| `uv: command not found` | uv がインストールされていません。ステップ1を確認してください |
| `git: command not found` | Git がインストールされていません。ステップ2を確認してください |
| モデルのダウンロードが遅い | 初回は数GBあるので時間がかかります。Wi-Fi環境での実行をおすすめします |
| 30b モデルが遅い・固まる | メモリ不足の可能性があります。`qwen3:8b` に切り替えてください |

---

## 使い方

### 起動する

```bash
# Pythonの基礎を学ぶ
novicode --mode python_basic

# データ分析を学ぶ（学習ログあり）
novicode --mode pandas --research

# 3D（A-Frame）を学ぶ
novicode --mode aframe

# モデルを指定して起動
novicode --mode sklearn --model qwen3-coder:30b

# レベルを指定して起動
novicode --mode python_basic --level intermediate
```

### 会話中に使えるコマンド

| コマンド | 何ができる？ |
|---------|------------|
| `/help` | コマンド一覧を表示 |
| `/exit` | 終了する |
| `/clear` | 会話履歴をクリア |
| `/progress` | 学習進捗を表示（習得済み概念の一覧） |
| `/level` | 現在のレベルを表示 |
| `/challenge` | 今のレベルに合った練習問題を出題 |
| `/hint` | 練習問題のヒントを表示 |
| `/metrics` | 学習の統計を表示 |
| `/status` | 今のセッション情報を表示 |
| `/save` | セッションと進捗を保存する |
| `/trace` | 直前のAIとのやりとりを表示 |

### 起動オプション一覧

| オプション | 説明 |
|-----------|------|
| `--mode` | **必須。** 学習モードを選ぶ（上の6つから1つ） |
| `--model` | 使うモデルを指定（省略すると自動選択） |
| `--level` | 開始レベルを指定（beginner / intermediate / advanced） |
| `--safe-mode` | より安全な制限を有効にする |
| `--debug` | デバッグ情報を表示する |
| `--max-iterations` | AIの最大思考回数（初期値: 50） |
| `--research` | 研究モード（すべてのやりとりを記録） |
| `--resume セッションID` | 前回の続きから再開 |
| `--list-sessions` | 保存済みセッション一覧 |
| `--export-session セッションID` | セッションをファイルに書き出す |

---

## 学習システム

### レベルと概念の追跡

NoviCode は、AIの回答から「何を学んだか」を自動的に検出し、記録します。

- 各モードに **初級・中級・上級** の3レベル
- レベルごとに学ぶべき **概念リスト** が定義されている
- ある概念が3回以上登場すると **習得済み** とみなす
- 現レベルの概念を60%以上習得すると **自動的にレベルアップ**

例えば `python_basic` モードの初級では、変数・型・print・条件分岐・ループ・関数・リスト を学びます。

進捗は `~/.novicode/progress/` に自動保存され、次回の起動時に引き継がれます。

### 段階的な教え方

NoviCode の AI は、完成品を一度に出しません。

```
ユーザー: 「電卓を作って」

AI: 「電卓を作りましょう。まず設計から考えます。

【ステップ1: 設計】
電卓に必要な機能は何でしょう？
- 足し算、引き算、掛け算、割り算
- ユーザーからの入力受付
- 結果の表示

まず、もっとも基本的な部分 — 2つの数字を受け取って足し算する —
から始めます。」

→ ステップ1のコードだけ書く → 動かさせる → 次のステップへ
```

### セキュリティ教育

危険な操作がブロックされたとき、ただ「ダメ」と言うだけでなく **なぜ危険かを教えます**。

```
🔒 【セキュリティ学習】
sudo は管理者権限でコマンドを実行します。
実際の開発では「最小権限の原則」が重要です。
→ プログラムには必要最小限の権限だけを与えましょう。
```

---

## 安全のしくみ

NoviCode は、学習者が安心して使えるようにたくさんの安全対策をしています。

### やってはいけないことを自動でブロック

- `sudo`, `rm -rf`, `chmod` などの危険なコマンド
- `curl`, `wget`, `ssh` などのネットワーク通信
- `pip install`, `npm install` などのパッケージ追加
- 作業フォルダの外へのファイル書き込み

### コードの中身もチェック

- `requests`, `subprocess` などの危険なライブラリの使用を検出
- モードで許可されていないライブラリの使用を検出
- URLやAPIへのアクセスを検出

すべてブロックされ、安全な範囲でのみ動作します。

---

## 研究モード（先生・研究者向け）

`--research` をつけて起動すると、すべてのやりとりが記録されます。

```bash
novicode --mode python_basic --research
```

記録される内容：

- 学習者の質問（プロンプト）
- AIの回答
- バリデーション違反（言語混在など）
- ツールの使用状況
- 学んだ概念
- 思考回数と時間

### データの書き出し

```bash
# セッション一覧を見る
novicode --mode python_basic --list-sessions

# 特定のセッションを書き出す
novicode --mode python_basic --export-session abc123def456
```

JSONL形式で出力されるので、pandas や jq で分析できます。

---

## プロジェクト構成

```
novicode/
├── main.py              # メインの起動ファイル
├── cli.py               # コマンドライン引数の処理
├── agent_loop.py        # AIとの対話ループ
├── llm_adapter.py       # Ollamaとの通信
├── tool_registry.py     # ツールの管理と実行
├── security_manager.py  # 安全チェック（コマンド・パス）+ セキュリティ教育
├── policy_engine.py     # モード別のルール管理 + 教育プロンプト合成
├── validator.py         # 出力の検証（言語分離など）+ 教育フィードバック
├── curriculum.py        # レベル定義・概念カタログ・教育プロンプト
├── progress.py          # 学習進捗の追跡・永続化
├── challenges.py        # 練習問題（36問）
├── session_manager.py   # セッションの保存・再開
├── metrics.py           # 統計の記録
├── config.py            # 設定値・定数
└── tools/               # 各ツールの実装
    ├── bash_tool.py     # シェルコマンド実行
    ├── read_tool.py     # ファイル読み取り
    ├── write_tool.py    # ファイル書き込み
    ├── edit_tool.py     # ファイル編集
    ├── grep_tool.py     # テキスト検索
    └── glob_tool.py     # ファイル名検索
```

---

## ふつうのAIツールとのちがい

| 比較ポイント | ふつうのAIツール | NoviCode |
|------------|----------------|----------|
| 教え方 | 完成品を一括出力 | ステップバイステップで段階的に |
| 学習追跡 | なし | 概念の習得を自動追跡・レベルアップ |
| 練習問題 | なし | モード・レベルに合った問題を出題 |
| セキュリティ教育 | なし | 危険な操作をブロック時に理由を解説 |
| 動く場所 | クラウド（ネット必要） | 自分のパソコンだけ |
| 言語の混在 | よくある | 起きない |
| ライブラリ制限 | なし | モードごとに許可制 |
| 学習ログ | なし or バラバラ | JSONL形式で統一 |

---

## ライセンス

MIT ライセンスです。自由に使えます。詳しくは [LICENSE](LICENSE) をご覧ください。

---

## 開発に参加するには

プルリクエスト歓迎です。以下のルールを守ってください。

1. モードごとの言語分離を壊さないこと
2. 対応モデルを勝手に増やさないこと（事前に相談）
3. 新しいバリデーションルールにはテストをつけること
4. 既存のコードスタイル（型ヒント、docstring）に合わせること
